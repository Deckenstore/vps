name: Permanent Free VPS

on:
  workflow_dispatch:
  schedule:
    - cron: "*/30 * * * *"

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 350

    steps:
      - name: Start VPS
        run: |
          echo "Updating system..."
          sudo apt update -y
          sudo apt install -y shellinabox wget unzip

          echo "Starting Web Terminal on port 7681..."
          sudo systemctl enable shellinabox
          sudo sed -i 's/--no-beep/--no-beep --disable-ssl/' /etc/default/shellinabox
          sudo systemctl restart shellinabox

      - name: Setup Cloudflare Tunnel (Permanent Link)
        run: |
          echo "Downloading Cloudflare..."
          wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64
          chmod +x cloudflared-linux-amd64

          echo "Starting Tunnel..."
          ./cloudflared-linux-amd64 tunnel --url http://localhost:7681 > tunnel.log 2>&1 &

          sleep 10
          echo "========== WEB TERMINAL LINK BELOW =========="
          grep -o 'https://.*trycloudflare.com' tunnel.log
          echo "============================================="

      - name: Keep VPS Alive
        run: |
          echo "VPS Running..."
          sleep 21600
